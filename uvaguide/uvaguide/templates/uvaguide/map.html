{% extends 'uvaguide/base.html' %}
{% block content %}
<!-- load custome css styles -->
{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'uvaguide/css/custom-style.css' %}" />

<p>&emsp;</p>
<div class="container searchBar">
    <p> Search:
        <input id="autocomplete" placeholder="Enter a place" type="text" size="50">
    </p>
</div>
<p></p>
<div class="container map">
    <iframe id="map" height=90% width=100% style="border:0" loading="lazy" allowfullscreen src={{ location }}>
    </iframe>
</div>

<!-- Loading in Places library for autocomplete and search -->
<!-- Code adapted from https://developers.google.com/maps/documentation/javascript/examples/places-autocomplete-->
<script>

    let autocomplete;
    function initAutocomplete() {
        autocomplete = new google.maps.places.Autocomplete(
            document.getElementById('autocomplete'),
            {
                types: ['establishment'],
                componenetRestrictions: { 'country': ['AU'] },
                fields: ['place_id', 'geometry', 'name']
            });
        autocomplete.addListener('place_changed', onPlaceChanged);
    }
    function onPlaceChanged() {
        var place = autocomplete.getPlace();
        if (!place.geometry) {
            document.getElementById('autocomplete').placeholder = "Enter a Place";
        } else {
            name = place.name.replaceAll(' ', '+');
            name = name.replaceAll('&', 'and');
            name = name.replaceAll("'", "");
            location = "/map/" + name;
        }
    }
</script>
<script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCdaz10ER7OvsL15_iMY2hozh7-KEsukb4&libraries=places&callback=initAutocomplete"
    async defer>
    </script>
{% endblock %}